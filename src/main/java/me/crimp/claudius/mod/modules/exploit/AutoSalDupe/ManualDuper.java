package me.crimp.claudius.mod.modules.exploit.AutoSalDupe;

import me.crimp.claudius.mod.command.Command;
import me.crimp.claudius.mod.modules.Module;
import me.crimp.claudius.mod.setting.Setting;
import me.crimp.claudius.utils.Timer;
import net.minecraft.block.Block;
import net.minecraft.block.BlockChest;
import net.minecraft.client.gui.inventory.GuiScreenHorseInventory;
import net.minecraft.entity.Entity;
import net.minecraft.entity.passive.AbstractChestHorse;
import net.minecraft.init.Items;
import net.minecraft.inventory.ClickType;
import net.minecraft.item.ItemBlock;
import net.minecraft.item.ItemShulkerBox;
import net.minecraft.item.ItemStack;
import net.minecraft.network.play.client.CPacketUseEntity;
import net.minecraft.util.EnumHand;
import org.lwjgl.input.Keyboard;

import java.util.Comparator;

public class ManualDuper extends Module {
    public ManualDuper() {
        super("AutoDuper", "AutoDuper", Category.EXPLOIT, true, false, false);
    }

    private boolean noBypass;

    @Override
    public void onEnable() {

        super.onEnable();

        Entity l_Entity = mc.world.loadedEntityList.stream()
                .filter(p_Entity -> isValidEntity(p_Entity))
                .min(Comparator.comparing(p_Entity -> mc.player.getDistance(p_Entity)))
                .orElse(null);

        if(mc.currentScreen instanceof GuiScreenHorseInventory && l_Entity instanceof AbstractChestHorse && mc.player.getRidingEntity() != null) {
            AbstractChestHorse abstractChestHorse = (AbstractChestHorse) l_Entity;

            if(abstractChestHorse.hasChest()) {
                noBypass = true;
                mc.player.connection.sendPacket(new CPacketUseEntity(l_Entity, EnumHand.MAIN_HAND, l_Entity.getPositionVector()));
                noBypass = false;
                toggle();
            }

        }

    }

    private boolean isValidEntity(Entity entity)
    {
        if (entity instanceof AbstractChestHorse) {
            AbstractChestHorse l_AbstractChestHorse = (AbstractChestHorse) entity;

            if (!l_AbstractChestHorse.isChild() && l_AbstractChestHorse.isTame())
                return true;
        }
        return false;
    }

    public boolean ignoreMountBypass() { //tell mount bypass when to disable
        return noBypass;
    }

}
